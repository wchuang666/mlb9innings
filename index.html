<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>MLB 9局職棒 紀錄 (帳號同步版)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MLB紀錄">

  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { 
      getAuth, 
      signInAnonymously, 
      onAuthStateChanged,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      signOut,
      linkWithCredential,
      EmailAuthProvider
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    window.Firebase = {
      initializeApp, getAuth, signInAnonymously, onAuthStateChanged,
      signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, linkWithCredential, EmailAuthProvider,
      getFirestore, collection, addDoc, deleteDoc, doc, onSnapshot, serverTimestamp, query, orderBy
    };
    window.dispatchEvent(new Event('firebase-ready'));
  </script>

  <style>
    body {
      padding-top: env(safe-area-inset-top);
      padding-bottom: env(safe-area-inset-bottom);
      background-color: #020617;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      overflow: hidden;
    }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    input, button, select { outline: none; -webkit-tap-highlight-color: transparent; }
    input[type="date"] { color-scheme: dark; }
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .animate-slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .animate-fade-in { animation: fadeIn 0.3s ease-out; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useMemo, useRef } = React;
    
    // --- 您的 Firebase 金鑰 ---
    const FIREBASE_CONFIG = {
      apiKey: "AIzaSyC7Jz7ieZjsUj009CmYcm3VAg3831n9ESQ",
      authDomain: "mlb9innings-7f1c1.firebaseapp.com",
      projectId: "mlb9innings-7f1c1",
      storageBucket: "mlb9innings-7f1c1.firebasestorage.app",
      messagingSenderId: "80304141620",
      appId: "1:80304141620:web:0a29c6db9132d04bc72161",
      measurementId: "G-GK8WL8XSVT"
    };

    // Icon 元件
    const Icon = ({ name, size = 20, className = "" }) => {
      const containerRef = useRef(null);
      useEffect(() => {
        if (!window.lucide || !containerRef.current) return;
        containerRef.current.innerHTML = '';
        const i = document.createElement('i');
        i.setAttribute('data-lucide', name);
        containerRef.current.appendChild(i);
        window.lucide.createIcons({ root: containerRef.current, attrs: { width: size, height: size, class: className } });
      }, [name, size, className]);
      return <span ref={containerRef} style={{ display: 'inline-flex', alignItems: 'center', justifyContent: 'center' }}></span>;
    };

    const App = () => {
      // 系統狀態
      const [firebaseReady, setFirebaseReady] = useState(false);
      const [initError, setInitError] = useState('');
      const [user, setUser] = useState(null);
      const [db, setDb] = useState(null);
      const [auth, setAuth] = useState(null);
      const [activeUserId, setActiveUserId] = useState(null);

      // UI 狀態
      const [currentView, setCurrentView] = useState('accounts');
      const [selectedAccount, setSelectedAccount] = useState(null);
      const [isAuthModalOpen, setIsAuthModalOpen] = useState(false);
      const [isProfileModalOpen, setIsProfileModalOpen] = useState(false); // 控制選擇視窗
      
      // 資料狀態
      const [accounts, setAccounts] = useState([]);
      const [accountCards, setAccountCards] = useState([]);

      // 表單狀態
      const [isAccountModalOpen, setIsAccountModalOpen] = useState(false);
      const [isCardModalOpen, setIsCardModalOpen] = useState(false);
      const [newAccountName, setNewAccountName] = useState('');
      const [newAccountSince, setNewAccountSince] = useState('');
      const [newCardName, setNewCardName] = useState('');
      const [newCardType, setNewCardType] = useState('signature');
      const [newCardDate, setNewCardDate] = useState(new Date().toISOString().split('T')[0]);

      // 認證表單狀態
      const [authMode, setAuthMode] = useState('login'); 
      const [email, setEmail] = useState('');
      const [password, setPassword] = useState('');
      const [authError, setAuthError] = useState('');
      const [isAuthLoading, setIsAuthLoading] = useState(false);

      const CARD_TYPES = [
        { id: 'signature', label: '簽名 (Signature)', color: 'text-green-400', border: 'border-green-500/50', bg: 'bg-green-500/10', icon: 'user' },
        { id: 'legend', label: '傳說 (Legend)', color: 'text-purple-400', border: 'border-purple-500/50', bg: 'bg-purple-500/10', icon: 'crown' },
        { id: 'supreme', label: '卓越 (Supreme)', color: 'text-red-400', border: 'border-red-500/50', bg: 'bg-red-500/10', icon: 'zap' },
        { id: 'prime', label: '全盛 (Prime)', color: 'text-blue-400', border: 'border-blue-500/30', bg: 'bg-blue-500/10', icon: 'star' },
        { id: 'vintage', label: '經典 (Vintage)', color: 'text-amber-600', border: 'border-amber-600/30', bg: 'bg-amber-600/10', icon: 'activity' },
        { id: 'normal', label: '一般/其他', color: 'text-gray-400', border: 'border-gray-600/30', bg: 'bg-gray-600/10', icon: 'user' },
      ];

      // 1. 初始化邏輯
      useEffect(() => {
        const init = async () => {
          if (!window.Firebase) return;

          try {
            let app;
            try { 
              app = window.Firebase.initializeApp(FIREBASE_CONFIG); 
            } catch (e) { 
              if (e.code !== 'app/duplicate-app') throw e; 
            }
            
            const authInstance = window.Firebase.getAuth();
            const firestore = window.Firebase.getFirestore();
            setAuth(authInstance);
            setDb(firestore);

            window.Firebase.onAuthStateChanged(authInstance, async (u) => {
              if (u) {
                setUser(u);
                
                // 裝置 ID 邏輯
                if (u.isAnonymous) {
                  let savedStableId = localStorage.getItem('mlb_fixed_device_id_v2');
                  if (!savedStableId) {
                    savedStableId = u.uid;
                    localStorage.setItem('mlb_fixed_device_id_v2', savedStableId);
                  }
                  setActiveUserId(savedStableId);
                } else {
                  setActiveUserId(u.uid);
                }
              } else {
                await window.Firebase.signInAnonymously(authInstance);
              }
              setFirebaseReady(true);
            });
          } catch (e) {
            console.error("Init Error", e);
            setInitError("連線失敗，請檢查網路。");
          }
        };
        
        if (window.Firebase) init();
        else window.addEventListener('firebase-ready', init);
        return () => window.removeEventListener('firebase-ready', init);
      }, []);

      // 認證邏輯
      const handleAuth = async (e) => {
        e.preventDefault();
        setAuthError('');
        setIsAuthLoading(true);

        try {
          if (authMode === 'login') {
            await window.Firebase.signInWithEmailAndPassword(auth, email, password);
            setIsAuthModalOpen(false);
            
          } else {
            const credential = window.Firebase.EmailAuthProvider.credential(email, password);
            
            if (user && user.isAnonymous) {
              await window.Firebase.linkWithCredential(user, credential);
              alert("綁定成功！現在您可以在任何裝置登入此 Email 看到資料了。");
            } else {
              await window.Firebase.createUserWithEmailAndPassword(auth, email, password);
            }
            setIsAuthModalOpen(false);
          }
          setIsProfileModalOpen(false); // 關閉選擇視窗
          setTimeout(() => window.location.reload(), 500);

        } catch (err) {
          console.error(err);
          let msg = err.message;
          if (err.code === 'auth/email-already-in-use') msg = "此 Email 已被註冊，請直接登入。";
          if (err.code === 'auth/wrong-password') msg = "密碼錯誤。";
          if (err.code === 'auth/user-not-found') msg = "找不到此帳號。";
          if (err.code === 'auth/credential-already-in-use') msg = "此 Email 已綁定其他帳號。請直接登入。";
          if (err.code === 'auth/operation-not-allowed') msg = "請先到 Firebase Console 開啟 Email/Password 登入功能！";
          setAuthError(msg);
        } finally {
          setIsAuthLoading(false);
        }
      };

      const handleLogout = async () => {
        if(confirm('確定要登出嗎？登出後將變回訪客模式。')) {
          await window.Firebase.signOut(auth);
          window.location.reload();
        }
      };

      // 資料讀取
      useEffect(() => {
        if (!activeUserId || !db) return;
        const q = window.Firebase.query(window.Firebase.collection(db, 'artifacts', 'mlb_app', 'users', activeUserId, 'mlb_accounts'));
        const unsubscribe = window.Firebase.onSnapshot(q, (snapshot) => {
          setAccounts(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));
        }, (err) => {
           if(err.code === 'permission-denied') alert("權限不足。請確認 Firebase Rules 為測試模式 (allow read, write: if true;)。");
        });
        return () => unsubscribe();
      }, [activeUserId, db]);

      useEffect(() => {
        if (!activeUserId || !db || !selectedAccount) return;
        const cardsRef = window.Firebase.collection(db, 'artifacts', 'mlb_app', 'users', activeUserId, 'mlb_accounts', selectedAccount.id, 'cards');
        const unsubscribe = window.Firebase.onSnapshot(cardsRef, (snapshot) => {
          const loaded = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
          loaded.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
          setAccountCards(loaded);
        });
        return () => unsubscribe();
      }, [activeUserId, db, selectedAccount]);

      const stats = useMemo(() => {
        const counts = { signature: 0, legend: 0, supreme: 0, total: 0 };
        accountCards.forEach(card => {
          counts.total++;
          if (card.type === 'signature') counts.signature++;
          if (card.type === 'legend') counts.legend++;
          if (card.type === 'supreme') counts.supreme++;
        });
        return counts;
      }, [accountCards]);

      const getCardTypeInfo = (typeId) => CARD_TYPES.find(t => t.id === typeId) || CARD_TYPES[5];

      // 操作
      const handleCreateAccount = async (e) => {
        e.preventDefault();
        if (!newAccountName) return;
        try {
          await window.Firebase.addDoc(window.Firebase.collection(db, 'artifacts', 'mlb_app', 'users', activeUserId, 'mlb_accounts'), {
            name: newAccountName, since: newAccountSince || new Date().toISOString().split('T')[0], createdAt: window.Firebase.serverTimestamp()
          });
          setNewAccountName(''); setIsAccountModalOpen(false);
        } catch (e) { alert("失敗: " + e.message); }
      };

      const handleAddCard = async (e) => {
        e.preventDefault();
        if (!newCardName) return;
        try {
          const cardsRef = window.Firebase.collection(db, 'artifacts', 'mlb_app', 'users', activeUserId, 'mlb_accounts', selectedAccount.id, 'cards');
          await window.Firebase.addDoc(cardsRef, { name: newCardName, type: newCardType, date: newCardDate, createdAt: window.Firebase.serverTimestamp() });
          setNewCardName(''); setIsCardModalOpen(false);
        } catch (e) { alert("失敗: " + e.message); }
      };

      const handleDelete = async (coll, id) => {
        if(!confirm('確定刪除？')) return;
        try {
          await window.Firebase.deleteDoc(window.Firebase.doc(db, 'artifacts', 'mlb_app', 'users', activeUserId, 'mlb_accounts', ...coll, id));
        } catch (e) { alert("失敗: " + e.message); }
      };

      // 渲染
      if (initError) return <div className="h-screen w-full bg-slate-950 flex flex-col items-center justify-center text-red-400 p-4"><Icon name="alert-triangle" size={32}/><p className="mt-2">{initError}</p></div>;

      if (!firebaseReady) return <div className="h-screen w-full bg-slate-950 flex items-center justify-center text-slate-500"><div className="animate-spin mr-2"><Icon name="loader-2"/></div>連線中...</div>;

      if (currentView === 'accounts') {
        return (
          <div className="h-screen w-full bg-slate-950 text-white flex flex-col max-w-md mx-auto animate-fade-in relative">
            <div className="flex justify-between items-center px-6 py-6 pt-10">
              <div>
                <h1 className="text-2xl font-black italic tracking-tighter">MLB 9Innings</h1>
                <p className="text-blue-500 text-[10px] font-bold tracking-[0.2em] uppercase mt-1">Cloud Hub</p>
              </div>
              <div className="flex gap-3">
                <button onClick={() => setIsProfileModalOpen(true)} className="bg-slate-800 p-3 rounded-full shadow-lg active:scale-95 transition-all text-slate-300 hover:text-white hover:bg-slate-700 relative">
                  <Icon name="user" size={24} />
                  {user && !user.isAnonymous && <div className="absolute top-0 right-0 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-slate-950"></div>}
                </button>
                <button onClick={() => setIsAccountModalOpen(true)} className="bg-blue-600 p-3 rounded-full shadow-lg active:scale-95 transition-all"><Icon name="plus" className="text-white" size={24} /></button>
              </div>
            </div>

            {/* Profile Selection Modal (取代原本的 Settings 面板) */}
            {isProfileModalOpen && (
              <div className="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center p-6 z-50 animate-fade-in">
                <div className="bg-slate-900 border border-slate-700 w-full max-w-xs rounded-2xl p-6 shadow-2xl relative">
                  <button onClick={() => setIsProfileModalOpen(false)} className="absolute top-4 right-4 text-slate-500"><Icon name="x" size={20}/></button>
                  
                  <div className="flex flex-col items-center mb-6">
                    <div className="bg-slate-800 p-4 rounded-full mb-3">
                      <Icon name="user-circle" size={48} className="text-slate-400" />
                    </div>
                    <h3 className="text-lg font-bold text-white mb-1">
                      {user && !user.isAnonymous ? user.email : '訪客模式'}
                    </h3>
                    <p className="text-xs text-slate-500 text-center">
                      {user && !user.isAnonymous ? '您已登入雲端帳號' : '資料目前僅存在此裝置'}
                    </p>
                  </div>

                  <div className="space-y-3">
                    {user && user.isAnonymous ? (
                      <>
                        <button onClick={() => { setAuthMode('login'); setIsAuthModalOpen(true); }} className="w-full py-3 bg-slate-800 hover:bg-slate-700 rounded-xl text-sm font-bold text-white flex items-center justify-center gap-2 transition-colors border border-slate-700">
                          <Icon name="log-in" size={16} /> 登入舊帳號 (同步資料)
                        </button>
                        <button onClick={() => { setAuthMode('signup'); setIsAuthModalOpen(true); }} className="w-full py-3 bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl text-sm font-bold text-white shadow-lg flex items-center justify-center gap-2 active:scale-[0.98] transition-all">
                          <Icon name="cloud-upload" size={16} /> 註冊並綁定目前資料
                        </button>
                        <p className="text-[10px] text-slate-500 text-center mt-2 px-2">
                          * 綁定後，您可以在任何裝置登入此 Email 存取資料。
                        </p>
                      </>
                    ) : (
                      <button onClick={handleLogout} className="w-full py-3 bg-red-900/30 hover:bg-red-900/50 text-red-400 border border-red-900/50 rounded-xl text-sm font-bold flex items-center justify-center gap-2 transition-colors">
                        <Icon name="log-out" size={16} /> 登出帳號
                      </button>
                    )}
                  </div>
                  
                  <div className="mt-6 text-center">
                     <p className="text-[9px] text-slate-700 font-mono">ID: {activeUserId?.slice(0, 8)}</p>
                  </div>
                </div>
              </div>
            )}

            <div className="flex-1 overflow-y-auto no-scrollbar px-6 pb-20 space-y-4">
              {accounts.map(acc => (
                <div key={acc.id} onClick={() => { setSelectedAccount(acc); setCurrentView('dashboard'); }} className="group bg-slate-900 border-l-4 border-blue-500 rounded-xl p-5 relative overflow-hidden active:bg-slate-800 transition-all cursor-pointer shadow-md">
                  <div className="absolute right-[-10px] top-[-10px] opacity-5 rotate-12 transition-transform group-hover:rotate-0"><Icon name="trophy" size={100} /></div>
                  <div className="flex justify-between items-start relative z-10">
                    <div>
                      <h3 className="text-xl font-bold mb-1 text-slate-100">{acc.name}</h3>
                      <div className="flex items-center text-slate-400 text-xs font-medium"><span className="mr-1.5"><Icon name="calendar" size={12} /></span>SINCE: <span className="ml-1 text-slate-300">{acc.since}</span></div>
                    </div>
                    <button onClick={(e) => { e.stopPropagation(); handleDelete([], acc.id); }} className="text-slate-600 p-2 -mr-2 -mt-2 active:text-red-400 hover:bg-slate-800 rounded-full"><Icon name="trash-2" size={16} /></button>
                  </div>
                </div>
              ))}
              {accounts.length === 0 && <div className="text-center py-16 opacity-30 text-slate-500 space-y-2"><Icon name="ghost" size={32} className="mx-auto"/><p className="text-sm">尚無球隊紀錄</p></div>}
            </div>

            {/* Login Modal (輸入框) */}
            {isAuthModalOpen && (
              <div className="fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center p-6 z-[60] animate-fade-in">
                <div className="bg-slate-900 border border-slate-700 w-full max-w-xs rounded-2xl p-6 shadow-2xl relative">
                  <button onClick={() => setIsAuthModalOpen(false)} className="absolute top-4 right-4 text-slate-500"><Icon name="x" size={20}/></button>
                  <h3 className="text-lg font-bold text-white mb-1 text-center">{authMode === 'login' ? '登入帳號' : '註冊並綁定'}</h3>
                  <p className="text-xs text-slate-400 text-center mb-6">
                    {authMode === 'login' 
                      ? '登入以存取雲端資料' 
                      : '將目前的訪客資料永久綁定到此帳號'}
                  </p>
                  
                  <form onSubmit={handleAuth} className="space-y-4">
                    <div className="space-y-1">
                      <label className="text-xs text-slate-400 font-bold ml-1">Email</label>
                      <input type="email" required className="w-full bg-slate-950 border border-slate-800 p-3 rounded-xl text-white focus:border-blue-500" placeholder="user@example.com" value={email} onChange={e => setEmail(e.target.value)} />
                    </div>
                    <div className="space-y-1">
                      <label className="text-xs text-slate-400 font-bold ml-1">密碼</label>
                      <input type="password" required className="w-full bg-slate-950 border border-slate-800 p-3 rounded-xl text-white focus:border-blue-500" placeholder="******" value={password} onChange={e => setPassword(e.target.value)} />
                    </div>
                    
                    {authError && <div className="bg-red-900/30 border border-red-900/50 p-2 rounded text-red-400 text-xs flex items-center gap-2"><Icon name="alert-circle" size={14}/> {authError}</div>}
                    
                    <button type="submit" disabled={isAuthLoading} className="w-full py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-bold flex justify-center items-center gap-2 transition-colors disabled:opacity-50">
                      {isAuthLoading && <Icon name="loader-2" className="animate-spin" size={16}/>}
                      {authMode === 'login' ? '登入' : '確認綁定'}
                    </button>
                  </form>

                  <div className="mt-4 pt-4 border-t border-slate-800 text-center">
                    <button onClick={() => { setAuthMode(authMode === 'login' ? 'signup' : 'login'); setAuthError(''); }} className="text-xs text-blue-400 hover:text-white transition-colors">
                      {authMode === 'login' ? '還沒有帳號？去註冊' : '已有帳號？去登入'}
                    </button>
                  </div>
                </div>
              </div>
            )}

            {isAccountModalOpen && (
              <div className="fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center p-6 z-50">
                <div className="bg-slate-900 border border-slate-700 w-full max-w-xs rounded-2xl p-6 shadow-2xl animate-slide-up">
                  <h3 className="text-lg font-bold mb-6 text-white flex items-center gap-2"><Icon name="plus-circle" size={20} className="text-blue-500" /> 建立新球隊</h3>
                  <form onSubmit={handleCreateAccount} className="space-y-4">
                    <input type="text" placeholder="球隊名稱" className="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl text-white mt-1" value={newAccountName} onChange={e => setNewAccountName(e.target.value)} required autoFocus />
                    <input type="date" className="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl text-white mt-1" value={newAccountSince} onChange={e => setNewAccountSince(e.target.value)} />
                    <div className="flex gap-3 pt-4">
                      <button type="button" onClick={() => setIsAccountModalOpen(false)} className="flex-1 py-3 text-slate-400">取消</button>
                      <button type="submit" className="flex-1 py-3 bg-blue-600 text-white rounded-xl font-bold">建立</button>
                    </div>
                  </form>
                </div>
              </div>
            )}
          </div>
        );
      }

      // 儀表板
      return (
        <div className="h-screen w-full bg-slate-950 text-white flex flex-col max-w-md mx-auto relative animate-fade-in">
          <div className="sticky top-0 bg-slate-950/80 backdrop-blur-md border-b border-slate-800 p-4 flex items-center gap-3 z-30 pt-safe-top">
            <button onClick={() => { setSelectedAccount(null); setCurrentView('accounts'); }} className="text-slate-400 p-1 hover:text-white -ml-2"><Icon name="chevron-left" size={28} /></button>
            <div className="flex-1 min-w-0">
              <h1 className="text-lg font-bold truncate">{selectedAccount.name}</h1>
              <p className="text-[10px] text-slate-500 font-mono">SINCE {selectedAccount.since}</p>
            </div>
            <div className="text-right bg-slate-900/50 px-3 py-1 rounded-lg border border-slate-800/50">
              <span className="text-[10px] text-slate-500 block uppercase font-bold tracking-wider">Total</span>
              <span className="font-mono font-bold text-lg text-white">{stats.total}</span>
            </div>
          </div>

          <div className="flex-1 overflow-y-auto no-scrollbar p-4 pb-24 space-y-6">
            <div className="grid grid-cols-3 gap-3">
              <div className="bg-green-500/10 border border-green-500/20 rounded-2xl p-3 flex flex-col items-center">
                <span className="text-3xl font-black text-green-400 my-1">{stats.signature}</span>
                <span className="text-[9px] uppercase tracking-widest text-green-200/50 font-bold">SIG</span>
              </div>
              <div className="bg-purple-500/10 border border-purple-500/20 rounded-2xl p-3 flex flex-col items-center">
                <span className="text-3xl font-black text-purple-400 my-1">{stats.legend}</span>
                <span className="text-[9px] uppercase tracking-widest text-purple-200/50 font-bold">LEG</span>
              </div>
              <div className="bg-red-500/10 border border-red-500/20 rounded-2xl p-3 flex flex-col items-center">
                <span className="text-3xl font-black text-red-400 my-1">{stats.supreme}</span>
                <span className="text-[9px] uppercase tracking-widest text-red-200/50 font-bold">SUP</span>
              </div>
            </div>

            <div>
              <div className="flex items-center justify-between mb-4 px-1">
                <h2 className="text-xs font-bold text-slate-500 uppercase tracking-widest flex items-center gap-2"><Icon name="layers" size={14} /> Records</h2>
                <button onClick={() => setIsCardModalOpen(true)} className="flex items-center gap-1.5 text-xs bg-blue-600 text-white px-4 py-2 rounded-full font-bold shadow-lg hover:bg-blue-500"><Icon name="plus" size={14} strokeWidth={3} /> ADD</button>
              </div>

              <div className="space-y-3">
                {accountCards.map(card => {
                  const type = getCardTypeInfo(card.type);
                  return (
                    <div key={card.id} className={`group flex items-center gap-4 bg-slate-900/80 p-4 rounded-2xl border-l-4 ${type.border.replace('/50','').replace('/30','')} shadow-sm backdrop-blur-sm transition-all hover:bg-slate-900`}>
                      <div className={`w-10 h-10 rounded-xl flex items-center justify-center shrink-0 ${type.bg} border border-white/5`}><Icon name={type.icon} className={type.color} size={20} /></div>
                      <div className="flex-1 min-w-0">
                        <div className="flex justify-between items-start"><h3 className="font-bold truncate text-base text-slate-100">{card.name}</h3></div>
                        <div className="flex items-center gap-2 mt-1.5">
                          <span className={`text-[10px] px-2 py-0.5 rounded-md font-bold tracking-wide ${type.bg} ${type.color} border border-white/5`}>{type.label.split(' ')[0]}</span>
                          <span className="text-[10px] text-slate-500 font-mono mt-0.5">{card.date}</span>
                        </div>
                      </div>
                      <button onClick={() => handleDelete([selectedAccount.id, 'cards'], card.id)} className="p-2 text-slate-600 opacity-50 group-hover:opacity-100 hover:text-red-400 active:scale-90 transition-all"><Icon name="trash-2" size={18} /></button>
                    </div>
                  );
                })}
                {accountCards.length === 0 && <div className="text-center py-12 opacity-30 text-sm">尚無紀錄</div>}
              </div>
            </div>
          </div>

          {isCardModalOpen && (
            <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-end justify-center sm:items-center">
              <div className="bg-slate-900 border-t sm:border border-slate-700 w-full max-w-md rounded-t-3xl sm:rounded-3xl p-6 animate-slide-up shadow-2xl pb-10 sm:pb-6">
                <div className="flex justify-between items-center mb-6">
                  <h3 className="text-xl font-bold text-white flex items-center gap-2"><Icon name="sparkles" size={20} className="text-yellow-500" /> 新增紀錄</h3>
                  <button onClick={() => setIsCardModalOpen(false)} className="text-slate-500 bg-slate-800 p-2 rounded-full hover:text-white"><Icon name="x" size={20} /></button>
                </div>
                <form onSubmit={handleAddCard} className="space-y-5">
                  <div>
                    <label className="text-xs text-slate-400 font-bold uppercase tracking-wider ml-1">球員名稱 / 年份</label>
                    <input type="text" placeholder="例如: Ohtani '24" className="w-full bg-slate-800 border border-slate-700 p-4 rounded-xl text-white mt-1.5 text-lg font-medium" value={newCardName} onChange={e => setNewCardName(e.target.value)} required autoFocus />
                  </div>
                  <div>
                    <label className="text-xs text-slate-400 font-bold uppercase tracking-wider ml-1">卡片種類</label>
                    <div className="grid grid-cols-3 gap-2 mt-1.5">
                      {CARD_TYPES.map(type => (
                        <button key={type.id} type="button" onClick={() => setNewCardType(type.id)} className={`text-[10px] py-3 px-1 rounded-xl border transition-all flex flex-col items-center gap-1.5 ${newCardType === type.id ? `${type.color} ${type.border} bg-slate-800 ring-2 ring-current font-bold shadow-lg` : 'text-slate-500 border-slate-800 bg-slate-800/50 hover:bg-slate-800'}`}>
                          <Icon name={type.icon} size={16} />{type.label.split(' ')[0]}
                        </button>
                      ))}
                    </div>
                  </div>
                  <div>
                    <label className="text-xs text-slate-400 font-bold uppercase tracking-wider ml-1">獲得日期</label>
                    <input type="date" className="w-full bg-slate-800 border border-slate-700 p-3 rounded-xl text-white mt-1.5" value={newCardDate} onChange={e => setNewCardDate(e.target.value)} />
                  </div>
                  <button type="submit" className="w-full py-4 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white rounded-xl font-bold text-lg mt-2">儲存紀錄</button>
                </form>
              </div>
            </div>
          )}
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
